# qix-graphql [![CircleCI](https://img.shields.io/circleci/project/github/stefanwalther/qix-graphql.svg)](https://circleci.com/gh/stefanwalther/qix-graphql) [![codecov](https://codecov.io/gh/stefanwalther/qix-graphql/branch/master/graph/badge.svg)](https://codecov.io/gh/stefanwalther/qix-graphql)

> GraphQL Server on top of the Qlik Associative Engine (QIX).

## Table of Contents

<details>

- [Motivation](#motivation)
- [Features](#features)
- [Installation](#installation)
- [Usage](#usage)
- [Roadmap](#roadmap)
- [Contribution](#contribution)
- [About](#about)
  * [Author](#author)
  * [License](#license)

_(TOC generated by [verb](https://github.com/verbose/verb) using [markdown-toc](https://github.com/jonschlinkert/markdown-toc))_

</details>

## Motivation

This **prototype** is following the idea of bringing the concept of [GraphQL](https://graphql.org/) together with the powerful Qlik Associative Engine (formerly also called QIX).
The given solution uses the following components:

- Qlik Core - Engine
- A GraphQL server being connected to the Qlik Engine

## Features

The GraphQL server provides two basic different types of endpoints:

**Global Scope:**

- Getting information about one environment (e.g. listing all Qlik apps, etc.)

**App Scope:**

- Connecting to a single Qlik app working with this app, such as
  - Getting the data from an app
  - Being able to query the various tables & fields
  - Making selections
  - Creating on demand hypercubes
  - etc.

## Installation
### From GitHub

First clone the repository:
```
$ git clone https://github.com/stefanwalther/qix-graphql
```

Then run the following command:

```
$ QIX_ENGINE_VER=12.171.0 QIX_ACCEPT_EULA=yes docker-compose up
```
Note: By setting QIX_ACCEPT_EULA to `yes`, you accept the EULA [as described here](https://qlikcore.com/docs/getting-started/).

Then open http://localhost:3004/global/graphql in your browser to get to the GraphQl user interface.

### Just using docker-compose
<details>
<summary><strong>Details</strong></summary>

Put this into a `docker-compose.yml` file:
```
version: '3.3'

volumes:
  sense-docs:

services:

  qix:
    container_name: qix
    image: "qlikcore/engine:${QIX_ENGINE_VER:-latest}"
    command: [
      "-S", "DocumentDirectory=/docs",
      "-S", "AcceptEULA=${QIX_ACCEPT_EULA:-no}"
    ]
    volumes:
      - sense-docs:/docs
    ports:
      - "9076:9076"
    expose:
      - 9076

  sense-docs:
    image: stefanwalther/sense-docs
    volumes:
      - sense-docs:/opt/sense-docs/docs
    tty: true

  qix-graphql:
    container_name: qix-graphql
    image: "stefanwalther/qix-graphql"
    ports:
      - "3004:3004"
    environment:
      - QIX_HOST=qix
      - QIX_PORT=9076
      - HOST=qix-graphql
      - PORT=3004
    restart: always
    command: ["npm", "run", "start"]
```

Then run `QIX_ENGINE_VER=12.171.0 QIX_ACCEPT_EULA=yes docker-compose up`

</details>

## Usage
### Work with the global scope

Open the GraphiQl UI: http://localhost:3004/global/graphql

Get the list of docs (apps):

```
{
  docs {
    qDocId
    qDocName
    qConnectedUsers
    qFileTime
    qFileSize
    qConnectedUsers
  }
}
```

Retrieve a single doc + links:

```
{
  doc(qDocId: "/docs/Consumer Goods Example.qvf") {
    qDocId
    _links {
      _doc
    }
  }
}
```

Copy the link of _links/_docs to connect to a single app (e.g. [http://localhost:3004/app/%2Fdocs%2FConsumer%20Goods%20Example.qvf/graphql](http://localhost:3004/app/%2Fdocs%2FConsumer%20Goods%20Example.qvf/graphql):

### Work with the app scope

Copying the value of the attribute `_links/_doc`, will give you the link to open another GraphiQl instance, *connecting to this single app*: 

This then allows you to get e.g. all content of a single table.

**Example:**

- Connect to `http://localhost:3004/app/%2Fdocs%2FConsumer%20Goods%20Example.qvf/graphql`
- Then execute the following query to get all data from the `AddressDetails` table:

```
{
  AddressDetails {
    Address_Number
    State
    Customer_Address_1
    Customer_Address_2
    Customer_Address_3
    Customer_Address_4
    Zip_Code
    City
    Country
    QlikPoint
    K
  }
}
```

## Roadmap
I have split the work in a few iterations:

- **[Iteration 1: Core prototyping work](https://github.com/stefanwalther/qix-graphql/projects/2)** **_<== !!! Sorry to say: WE ARE HERE !!!_**
  - Focus on core functionality
  - Testing various ideas/concepts
  - No UI work
  - Little documentation
  - Messy code ;-)
- **[Iteration 2: Some work on enhanced concepts](https://github.com/stefanwalther/qix-graphql/projects/3)**
  - JWT support / Section Access
  - Using multiple engines, using mira 
  - Using in Qlik Sense Multi Cloud
- **Iteration 3: Clean UI & additional functionality**

See [projects](https://github.com/stefanwalther/qix-graphql/projects) for more details.

## Contribution
<details>
<summary><strong>Contributing</strong></summary>
Pull requests and stars are always welcome. For bugs and feature requests, [please create an issue](https://github.com/stefanwalther/qix-graphql/issues). The process for contributing is outlined below:

1. Create a fork of the project
2. Work on whatever bug or feature you wish
3. Create a pull request (PR)

I cannot guarantee that I will merge all PRs but I will evaluate them all.
</details>

<details>
<summary><strong>Local Development</strong></summary>

The easiest way to develop locally is follow these steps:

1) Clone the GitHub repo
```
$ git clone https://github.com/stefanwalther/qix-graphql
```

2) Install the dependencies
```
$ npm install
```

3) Start the dependencies (Qlik Associative Engine + a few sample apps mounted):
```
$ make up-deps
```

Make your code changes, then:

- Run local tests: `npm run test`
- Run local tests with a watcher: `npm run test`
- Start the GraphQl server: `npm run start`
- Start the GraphQl server with a watcher: `npm run start:watch`

</details>

<details>
<summary><strong>Running Tests</strong></summary>

Having the local dependencies up and running, you can just run the tests by executing:

```
$ npm run test
```

If you want to have an watcher active, use:

```
$ npm run test:watch
```

</details>

<details>
<summary><strong>CircleCI Tests</strong></summary>

To simulate the tests running on CircleCI run the following:

```
$ make circleci-test
```

</details>

## About

### Author
**Stefan Walther**

* [twitter](http://twitter.com/waltherstefan)  
* [github.com/stefanwalther](http://github.com/stefanwalther) 
* [LinkedIn](https://www.linkedin.com/in/stefanwalther/) 
* [qliksite.io](http://qliksite.io)

### License
MIT

***

_This file was generated by [verb-generate-readme](https://github.com/verbose/verb-generate-readme), v0.6.0, on May 31, 2018._

